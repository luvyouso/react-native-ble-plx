commit f3149079d38ae62125e80ee14f25db5b807220cc
Author: Piotr Dubiel <piotr.dubiel@polidea.com>
Date:   Fri Feb 15 00:37:03 2019 +0100

    Add espresso test

diff --git a/App.js b/App.js
index bb48232..b42c931 100644
--- a/App.js
+++ b/App.js
@@ -1,50 +1,3 @@
-/**
- * Sample React Native App
- * https://github.com/facebook/react-native
- *
- * @format
- * @flow
- * @lint-ignore-every XPLATJSCOPYRIGHT1
- */
+import Diagnose from 'on-device-diagnose'
 
-import React, {Component} from 'react';
-import {Platform, StyleSheet, Text, View} from 'react-native';
-
-const instructions = Platform.select({
-  ios: 'Press Cmd+R to reload,\n' + 'Cmd+D or shake for dev menu',
-  android:
-    'Double tap R on your keyboard to reload,\n' +
-    'Shake or press menu button for dev menu',
-});
-
-type Props = {};
-export default class App extends Component<Props> {
-  render() {
-    return (
-      <View style={styles.container}>
-        <Text style={styles.welcome}>Welcome to React Native!</Text>
-        <Text style={styles.instructions}>To get started, edit App.js</Text>
-        <Text style={styles.instructions}>{instructions}</Text>
-      </View>
-    );
-  }
-}
-
-const styles = StyleSheet.create({
-  container: {
-    flex: 1,
-    justifyContent: 'center',
-    alignItems: 'center',
-    backgroundColor: '#F5FCFF',
-  },
-  welcome: {
-    fontSize: 20,
-    textAlign: 'center',
-    margin: 10,
-  },
-  instructions: {
-    textAlign: 'center',
-    color: '#333333',
-    marginBottom: 5,
-  },
-});
+export default Diagnose
diff --git a/android/app/build.gradle b/android/app/build.gradle
index 1f01fa3..207d72c 100644
--- a/android/app/build.gradle
+++ b/android/app/build.gradle
@@ -103,6 +103,7 @@ android {
         targetSdkVersion rootProject.ext.targetSdkVersion
         versionCode 1
         versionName "1.0"
+        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
     }
     splits {
         abi {
@@ -138,6 +139,10 @@ dependencies {
     implementation fileTree(dir: "libs", include: ["*.jar"])
     implementation "com.android.support:appcompat-v7:${rootProject.ext.supportLibVersion}"
     implementation "com.facebook.react:react-native:+"  // From node_modules
+    testImplementation 'junit:junit:4.12'
+    androidTestImplementation 'androidx.test.espresso:espresso-core:3.1.0'
+    androidTestImplementation 'androidx.test:runner:1.1.0'
+    androidTestImplementation 'androidx.test:rules:1.1.0'
 }
 
 // Run this once to be able to run the application with BUCK
diff --git a/android/app/src/androidTest/java/com/setup/BleManagerTest.java b/android/app/src/androidTest/java/com/setup/BleManagerTest.java
new file mode 100644
index 0000000..b165df9
--- /dev/null
+++ b/android/app/src/androidTest/java/com/setup/BleManagerTest.java
@@ -0,0 +1,39 @@
+package com.setup;
+
+import org.hamcrest.core.StringStartsWith;
+import org.junit.Before;
+import org.junit.Rule;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+import androidx.test.rule.ActivityTestRule;
+import androidx.test.runner.AndroidJUnit4;
+
+import static androidx.test.espresso.Espresso.onView;
+import static androidx.test.espresso.assertion.ViewAssertions.matches;
+import static androidx.test.espresso.assertion.ViewAssertions.selectedDescendantsMatch;
+import static androidx.test.espresso.matcher.ViewMatchers.isDisplayed;
+import static androidx.test.espresso.matcher.ViewMatchers.withContentDescription;
+import static androidx.test.espresso.matcher.ViewMatchers.withText;
+import static com.setup.EspressoViewFinder.waitForDisplayed;
+import static org.hamcrest.core.AllOf.allOf;
+
+
+@RunWith(AndroidJUnit4.class)
+public class BleManagerTest {
+
+
+    @Rule
+    public ActivityTestRule<MainActivity> mActivityRule
+            = new ActivityTestRule<>(MainActivity.class);
+
+    @Test
+    public void verifyTestSuite() {
+        waitForDisplayed(withContentDescription("TestSuite")).check(matches(isDisplayed()));
+        onView(withContentDescription(new StringStartsWith("TestCase-")))
+                .check(selectedDescendantsMatch(
+                        withContentDescription("TestCaseStatus"),
+                        withText("success")));
+
+    }
+}
diff --git a/android/app/src/androidTest/java/com/setup/EspressoViewFinder.java b/android/app/src/androidTest/java/com/setup/EspressoViewFinder.java
new file mode 100644
index 0000000..2387ed4
--- /dev/null
+++ b/android/app/src/androidTest/java/com/setup/EspressoViewFinder.java
@@ -0,0 +1,113 @@
+package com.setup;
+
+import android.graphics.Rect;
+import android.view.View;
+import android.view.ViewGroup;
+
+import org.hamcrest.Description;
+import org.hamcrest.Matcher;
+import org.hamcrest.TypeSafeMatcher;
+
+import java.util.concurrent.TimeoutException;
+
+import androidx.test.espresso.PerformException;
+import androidx.test.espresso.UiController;
+import androidx.test.espresso.ViewAction;
+import androidx.test.espresso.ViewInteraction;
+import androidx.test.espresso.matcher.ViewMatchers;
+import androidx.test.espresso.util.HumanReadables;
+import androidx.test.espresso.util.TreeIterables;
+
+import static androidx.test.espresso.Espresso.onView;
+import static androidx.test.espresso.matcher.ViewMatchers.isRoot;
+import static androidx.test.espresso.matcher.ViewMatchers.withEffectiveVisibility;
+
+public class EspressoViewFinder {
+    private static long CHECK_INTERVAL = 50L;
+    private static long TIMEOUT_MS = 10 * 1000L;
+
+
+    static ViewInteraction waitForDisplayed(Matcher<View> viewMatcher) {
+
+        return onView(isRoot()).perform(createWaitForDisplayedViewAction(viewMatcher, TIMEOUT_MS));
+    }
+
+    private static ViewAction createWaitForDisplayedViewAction(final Matcher<View> viewMatcher,
+                                                               final Long timeOut) {
+        return new ViewAction() {
+            @Override
+            public Matcher<View> getConstraints() {
+                return isRoot();
+            }
+
+            @Override
+            public String getDescription() {
+                return "waitForDisplayed on viewMatcher <$viewMatcher> without timeOut $timeOut ms.";
+            }
+
+            @Override
+            public void perform(UiController uiController, View view) {
+                uiController.loopMainThreadUntilIdle();
+
+                boolean found = waitForView(uiController, view);
+
+                if (!found) {
+                    throw createPerformException(view);
+                }
+            }
+
+            private boolean waitForView(UiController uiController, View view) {
+
+                long timeOutTimeStamp = System.currentTimeMillis() + timeOut;
+                do {
+                    // find view with required matcher:
+                    for (View child : TreeIterables.breadthFirstViewTraversal(view)) {
+                        if (viewMatcher.matches(child) && isDisplayed(child)) {
+                            return true;
+                        }
+                    }
+                    uiController.loopMainThreadForAtLeast(CHECK_INTERVAL);
+                } while (System.currentTimeMillis() < timeOutTimeStamp);
+
+                return false;
+            }
+
+            private PerformException createPerformException(View view) {
+                return new PerformException.Builder()
+                        .withActionDescription(this.getDescription())
+                        .withViewDescription(HumanReadables.describe(view))
+                        .withCause(new TimeoutException())
+                        .build();
+            }
+        };
+    }
+
+
+    private static boolean isDisplayed(View view) {
+        return view.getGlobalVisibleRect(new Rect()) &&
+                withEffectiveVisibility(ViewMatchers.Visibility.VISIBLE).matches(view);
+    }
+
+    /**
+     * Finds a matcher's view's child at the given index.
+     */
+    Matcher<View> childAtIndex(final Matcher<View> parentMatcher, final int childPosition) {
+        return new TypeSafeMatcher<View>() {
+            @Override
+            protected boolean matchesSafely(View view) {
+                if (view.getParent() instanceof ViewGroup) {
+                    return parentMatcher.matches(view.getParent());
+                }
+
+                ViewGroup group = (ViewGroup) view.getParent();
+                return parentMatcher.matches(view.getParent()) && group.getChildAt(childPosition) == view;
+            }
+
+            @Override
+            public void describeTo(Description description) {
+                description.appendText("childAtIndex $childPosition of type $parentMatcher");
+            }
+        };
+    }
+
+}
